from PyQt5.QtCore import *
from PyQt5.QtWidgets import *
from PyQt5.QtGui import *
import sys
import random

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.ysize = 0
        self.xsize = 0
        self.winnomin = 0
        self.score = 0
        self.timer = False
        self.curmode = 0
        best_score_mode1 = 0
        best_score_mode2 = 0
        best_score_mode3 = 0
        best_score_mode4 = 0
        self.best_scores_lst = [best_score_mode1, best_score_mode2, best_score_mode3, best_score_mode4]
        best_tile_mode1 = 0
        best_tile_mode2 = 0
        best_tile_mode3 = 0
        best_tile_mode4 = 0
        self.best_tiles_lst = [best_tile_mode1, best_tile_mode2, best_tile_mode3, best_tile_mode3]
        self.merge_cnt = 0
        self.clrtheme = 'classic'
        self.achievments_cnt = 0
        self.curwin = 0
        self.newwin = 1

        self.isWindowAnimEnd = True
        self.isMenuActive = False
        self.changes = False
        self.isGameStoped = False
        self.opacity = QGraphicsOpacityEffect()
        self.opacity.setOpacity(0)
        self.tilesize = 150
        self.fonts_parent = QLabel(self)
        self.score_plain_font = self.fonts_parent.font()
        self.score_plain_font.setPointSize(14)
        self.score_plain_font.setBold(True)
        self.tile_font = self.fonts_parent.font()
        self.tile_font.setPointSize(40)
        self.tile_font.setBold(True)
        self.tile_font2 = self.fonts_parent.font()
        self.tile_font2.setPointSize(25)
        self.tile_font2.setBold(True)
        self.tile_font3 = self.fonts_parent.font()
        self.tile_font3.setPointSize(20)
        self.tile_font3.setBold(True)
        self.tile_font4 = self.fonts_parent.font()
        self.tile_font4.setPointSize(18)
        self.tile_font4.setBold(True)
        self.tile_font5 = self.fonts_parent.font()
        self.tile_font5.setPointSize(30)
        self.tile_font5.setBold(True)
        self.icon_font = self.fonts_parent.font()
        self.icon_font.setPointSize(50)
        self.icon_font.setBold(True)
        self.icon_font_mini = self.fonts_parent.font()
        self.icon_font_mini.setPointSize(35)
        self.icon_font_mini.setBold(True)
        self.desc_font = self.fonts_parent.font()
        self.desc_font.setPointSize(25)
        self.desc_font.setBold(True)
        self.desc_font_mini = self.fonts_parent.font()
        self.desc_font_mini.setPointSize(15)
        self.achiev_font = self.fonts_parent.font()
        self.achiev_font.setPointSize(18)
        self.achiev_font.setBold(True)
        self.achiev_font_mini = self.fonts_parent.font()
        self.achiev_font_mini.setPointSize(16)
        self.achiev_font_mini.setBold(True)
        self.achiev_desc_font = self.fonts_parent.font()
        self.achiev_desc_font.setPointSize(10)
        self.achiev_desc_font.setBold(True)
        self.action_timer = QTimer()
        self.action_timer.setInterval(100)
        self.action_timer.timeout.connect(self.enable_moving)
        self.menu_timer = QTimer()
        self.menu_timer.setInterval(300)
        self.menu_timer.timeout.connect(self.enable_menu_moving)
        self.window_timer = QTimer()
        self.window_timer.setInterval(600)
        self.window_timer.timeout.connect(self.move_window)
        self.fast_mode_timer = QTimer()
        self.fast_mode_timer.setInterval(3000)
        self.msg_timer = QTimer()
        self.msg_timer.setInterval(3000)
        self.msg_timer.timeout.connect(self.show_new_achievment_msg)
        self.new_game_timer = QTimer()
        self.new_game_timer.setInterval(600)
        self.new_game_timer.timeout.connect(self.new_game_tiles)
        self.setWindowTitle('2048')
        self.setWindowFlag(Qt.FramelessWindowHint)
        self.desk_w = QApplication.desktop().width()
        self.desk_h = QApplication.desktop().height()
        self.choose_mode(3)
        self.game_window_init()
        self.mode_window_init()
        self.theme_window_init()
        self.achievments_window_init()
        self.rules_window_init()
        self.stats_window_init()
        self.menu_init()
        self.clr_change(self.clrtheme)
        self.windows = [self.game_widgets, self.mode_widgets, self.theme_widgets, self.achievments_widgets, self.rules_widgets, self.stats_widgets]
        self.windows_btns = (self.menu_game, self.menu_mode, self.menu_theme, self.menu_achievments, self.menu_rules, self.menu_stats)
        self.btns_focus_disable()
        for _ in range(2):
            self.add_tile()

    def choose_mode(self, mode: int):
        self.curmode = mode
        match mode:
            case 0:
                self.ysize = 4
                self.xsize = 4
                self.winnomin = 2048
                self.timer = False
            case 1:
                self.ysize = 3
                self.xsize = 3
                self.winnomin = 512
                self.timer = False
            case 2:
                self.ysize = 4
                self.xsize = 4
                self.winnomin = 2048
                self.timer = True
            case 3:
                self.ysize = 6
                self.xsize = 6
                self.winnomin = 2048
                self.timer = False
            
    def achievments_check(self):
        cnt = 0
        for i in range(self.ysize):
            for j in range(self.xsize):
                if self.xsize == 4 and self.ysize == 4:
                    if self.game_area[i][j][2] == 8 and not self.achievments_dict[self.achiev1_ico]:
                        self.achievments_dict[self.achiev1_ico] = True
                        self.achievments_cnt += 1
                        self.show_new_achievment_msg()
                    if self.game_area[i][j][2] == 128 and not self.achievments_dict[self.achiev2_ico]:
                        self.achievments_dict[self.achiev2_ico] = True
                        self.achievments_cnt += 1
                        self.show_new_achievment_msg()
                    if self.game_area[i][j][2] == 2048 and not self.achievments_dict[self.achiev3_ico]:
                        self.achievments_dict[self.achiev3_ico] = True
                        self.achievments_cnt += 1
                        self.show_new_achievment_msg()
                    if self.game_area[i][j][2] == 4096 and not self.achievments_dict[self.achiev4_ico]:
                        self.achievments_dict[self.achiev4_ico] = True
                        self.achievments_cnt += 1
                        self.show_new_achievment_msg()
                elif self.xsize == 3 and self.ysize == 3:
                    if self.game_area[i][j][2] == 512 and not self.achievments_dict[self.achiev5_ico]:
                        self.achievments_dict[self.achiev5_ico] = True
                        self.achievments_cnt += 1
                        self.show_new_achievment_msg()
                if self.fast_mode_timer.isActive:
                    if self.game_area[i][j][2] == 2048 and not self.achievments_dict[self.achiev6_ico]:
                        self.achievments_dict[self.achiev6_ico] = True
                        self.achievments_cnt += 1
                        self.show_new_achievment_msg()
        if self.merge_cnt == 100000 and not self.achievments_dict[self.achiev7_ico]:
            self.achievments_dict[self.achiev7_ico] = True
            self.achievments_cnt += 1
            self.show_new_achievment_msg()
        if self.score == 1000000 and not self.achievments_dict[self.achiev8_ico]:
            self.achievments_dict[self.achiev8_ico] = True
            self.achievments_cnt += 1
            self.show_new_achievment_msg()
        for key, value in self.achievments_dict.items():
            cnt += 1
            if value:
                if cnt < 5:
                    colors = (self.tile_color2, self.text_color1)
                else:
                    colors = (self.text_color1, self.tile_color2)
                key.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % colors)
    
    def show_new_achievment_msg(self):
        msg_anim_group = QParallelAnimationGroup(self)
        if self.msg_timer.isActive():
            self.msg_timer.stop()
            shift = 430
        else:
            self.msg_timer.start()
            shift = -430
        for el in self.achievment_msg:
                anim = QPropertyAnimation(el, b'pos')
                anim.setDuration(500)
                anim.setEasingCurve(QEasingCurve.OutCubic)
                anim.setEndValue(QPoint(el.x(), el.y() + shift))
                msg_anim_group.addAnimation(anim)
        msg_anim_group.start()

    def show_winlose_msg(self, state: str):
        match state:
            case 'win':
                btn1 = self.new_game_btn
                btn2 = self.continue_game_btn
                btn1_panel = self.new_game_btn_panel
                btn2_panel = self.continue_game_btn_panel
                text = 'ПОБЕДА'
            case 'end':
                btn1 = self.new_game_btn
                btn2 = self.change_mode_btn
                btn1_panel = self.new_game_btn_panel
                btn2_panel = self.change_mode_btn_panel
                text = 'ИГРА ЗАКОНЧЕНА'
            case 'continue':
                return
        self.isGameStoped = True
        self.winlose_msg_text.setText(text)
        btn1.setEnabled(True)
        btn2.setEnabled(True)
        opacity_anim = QPropertyAnimation(self.opacity, b'opacity', self)
        opacity_anim.setStartValue(0)
        opacity_anim.setEndValue(0.7)
        opacity_anim.setDuration(200)
        opacity_anim.start()
        size_anim_group = QParallelAnimationGroup(self)
        size_anim = QPropertyAnimation(btn1_panel, b'geometry')
        size_anim.setDuration(200)
        size_anim.setEndValue(QRect(670, 730, 270, 80))
        size_anim_group.addAnimation(size_anim)
        size_anim = QPropertyAnimation(btn2_panel, b'geometry')
        size_anim.setDuration(200)
        size_anim.setEndValue(QRect(980, 730, 270, 80))
        size_anim_group.addAnimation(size_anim)
        size_anim_group.start()

    def stats_update(self):
        self.stats_bs1_val.setText(' ' + str(self.best_scores_lst[0]))
        self.stats_bs2_val.setText(' ' + str(self.best_scores_lst[1]))
        self.stats_bs3_val.setText(' ' + str(self.best_scores_lst[2]))
        self.stats_bt1_val.setText(' ' + str(self.best_tiles_lst[0]))
        self.stats_bt2_val.setText(' ' + str(self.best_tiles_lst[1]))
        self.stats_bt3_val.setText(' ' + str(self.best_tiles_lst[2]))
        self.stats_ttm_val.setText(' ' + str(self.merge_cnt))
        self.stats_ac_val.setText(' ' + str(self.achievments_cnt))

    def btns_focus_disable(self):
        app_btns = list(self.windows_btns) + [self.mode_btn1, self.mode_btn2, self.mode_btn3, self.mode_btn3, self.mode_btn4, self.theme1_btn, self.theme2_btn, self.theme3_btn, self.menu_exit, self.menu_btn]
        for btn in app_btns:
            btn.setFocusPolicy(Qt.NoFocus)

    def clr_change(self, clrtheme: str):
        self.clrtheme = clrtheme
        match clrtheme:
            case 'classic':
                self.tile_color2 = '#eee4da'
                self.tile_color4 = '#eee1c9'
                self.tile_color8 = '#f3b27a'
                self.tile_color16 = '#f69664'
                self.tile_color32 = '#f77c5f'
                self.tile_color64 = '#f75f3b'
                self.tile_color128 = '#f8d669'
                self.tile_color256 = '#f8df5a'
                self.tile_color512 = '#ffe03e'
                self.tile_color1024 = '#ffda18'
                self.tile_color2048 = '#ffd600'
                self.pad_color = '#bbada0'
                self.text_color1 = '#776e65'
                self.text_color2 = '#f9f6f2'
                self.hollow_color = '#cdc1b4'
            case 'cold':
                self.tile_color2 = '#DAEEEA'
                self.tile_color4 = '#D1DDE4'
                self.tile_color8 = '#80DBED'
                self.tile_color16 = '#5AB3CB'
                self.tile_color32 = '#5696AB'
                self.tile_color64 = '#04597C'
                self.tile_color128 = '#52A499'
                self.tile_color256 = '#458D83'
                self.tile_color512 = '#48746E'
                self.tile_color1024 = '#4D6E69'
                self.tile_color2048 = '#38544A'
                self.pad_color = '#A0B3BB'
                self.text_color1 = '#657477'
                self.text_color2 = '#F2F7F9'
                self.hollow_color = '#BED1D6'
            case 'gray':
                self.tile_color2 = '#E2E2E2'
                self.tile_color4 = '#CECECE'
                self.tile_color8 = '#BEBEBE'
                self.tile_color16 = '#959595'
                self.tile_color32 = '#7B7B7B'
                self.tile_color64 = '#6E6E6E'
                self.tile_color128 = '#525252'
                self.tile_color256 = '#434343'
                self.tile_color512 = '#383838'
                self.tile_color1024 = '#323232'
                self.tile_color2048 = '#2D2D2D'
                self.pad_color = '#5B5B5B'
                self.text_color1 = '#464646'
                self.text_color2 = '#FAFAFA'
                self.hollow_color = '#676767'
        self.mode1_png = QPixmap(f'sprites\{clrtheme}\mode1.png')
        self.mode1_png.setMask(self.mode1_png.createHeuristicMask(Qt.transparent))
        self.mode2_png = QPixmap(f'sprites\{clrtheme}\mode2.png')
        self.mode2_png.setMask(self.mode2_png.createHeuristicMask(Qt.transparent))
        self.mode3_png = QPixmap(f'sprites\{clrtheme}\mode3.png')
        self.mode3_png.setMask(self.mode3_png.createHeuristicMask(Qt.transparent))
        self.mode4_png = QPixmap(f'sprites\{clrtheme}\mode4.png')
        self.mode4_png.setMask(self.mode4_png.createHeuristicMask(Qt.transparent))
        self.menu_btn_png = QPixmap(f'sprites\{clrtheme}\menu_btn.png')
        self.menu_btn_png = self.menu_btn_png.scaled(120, 120)
        self.menu_btn_png.setMask(self.menu_btn_png.createHeuristicMask(Qt.transparent))
        self.theme1_png = QPixmap(r'sprites\theme1.png')
        self.theme1_png.setMask(self.theme1_png.createHeuristicMask(Qt.transparent))
        self.theme2_png = QPixmap(r'sprites\theme2.png')
        self.theme2_png.setMask(self.theme2_png.createHeuristicMask(Qt.transparent))
        self.theme3_png = QPixmap(r'sprites\theme3.png')
        self.theme3_png.setMask(self.theme3_png.createHeuristicMask(Qt.transparent))
        self.color_dict = {2: self.tile_color2,
                           4: self.tile_color4,
                           8: self.tile_color8,
                           16: self.tile_color16,
                           32: self.tile_color32,
                           64: self.tile_color64,
                           128: self.tile_color128,
                           256: self.tile_color256,
                           512: self.tile_color512,
                           1024: self.tile_color1024,
                           2048: self.tile_color2048
                           }
        self.setStyleSheet("background-color: %s" % self.text_color2)
        self.mode_title.setStyleSheet('color: %s' % self.text_color1)
        self.mode_pad1.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.mode_pad2.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.mode_pad3.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.mode_pad4.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.mode_mode1.setStyleSheet('background-color: %s; color: %s' % (self.text_color2, self.text_color1))
        self.mode_mode2.setStyleSheet('background-color: %s; color: %s' % (self.text_color2, self.text_color1))
        self.mode_mode3.setStyleSheet('background-color: %s; color: %s' % (self.text_color2, self.text_color1))
        self.mode_mode4.setStyleSheet('background-color: %s; color: %s' % (self.text_color2, self.text_color1))
        self.mode_desc1.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color2))
        self.mode_desc2.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color2))
        self.mode_desc3.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color2))
        self.mode_desc4.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color2))
        self.mode_img1.setPixmap(self.mode1_png)
        self.mode_img2.setPixmap(self.mode2_png)
        self.mode_img3.setPixmap(self.mode3_png)
        self.mode_img4.setPixmap(self.mode4_png)
        self.theme_title.setStyleSheet('color: %s' % self.text_color1)
        self.theme1.setStyleSheet("background-color: %s; border-radius: 10px" % self.pad_color)
        self.theme2.setStyleSheet("background-color: %s; border-radius: 10px" % self.pad_color)
        self.theme3.setStyleSheet("background-color: %s; border-radius: 10px" % self.pad_color)
        self.theme1.setPixmap(self.theme1_png)
        self.theme2.setPixmap(self.theme2_png)
        self.theme3.setPixmap(self.theme3_png)
        self.achievments_title.setStyleSheet('color: %s' % self.text_color1)
        self.achiev1_pad.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.achiev2_pad.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.achiev3_pad.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.achiev4_pad.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.achiev5_pad.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.achiev6_pad.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.achiev7_pad.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.achiev8_pad.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.achiev1_title.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color2))
        self.achiev2_title.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color2))
        self.achiev3_title.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color2))
        self.achiev4_title.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color2))
        self.achiev5_title.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color2))
        self.achiev6_title.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color2))
        self.achiev7_title.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color2))
        self.achiev8_2_title.setStyleSheet('background-color: %s; color: %s; border: 1px' % (self.pad_color, self.text_color2))
        self.achiev8_title.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color2))
        self.achiev1_ico.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.hollow_color, self.hollow_color))
        self.achiev2_ico.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.hollow_color, self.hollow_color))
        self.achiev3_ico.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.hollow_color, self.hollow_color))
        self.achiev4_ico.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.hollow_color, self.hollow_color))
        self.achiev5_ico.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.hollow_color, self.hollow_color))
        self.achiev6_ico.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.hollow_color, self.hollow_color))
        self.achiev7_ico.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.hollow_color, self.hollow_color))
        self.achiev8_ico.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.hollow_color, self.hollow_color))
        self.achiev1_desc.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.achiev2_desc.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.achiev3_desc.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.achiev4_desc.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.achiev5_desc.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.achiev6_desc.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.achiev7_desc.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.achiev8_desc.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.achievment_msg_pad.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.achievment_msg_text.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.pad_color, self.text_color1))
        self.achievment_msg_tile.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.tile_color2, self.text_color1))
        self.rules_title.setStyleSheet('color: %s' % self.text_color1)
        self.rules_rules.setStyleSheet('color: %s' % self.text_color1)
        self.stats_title.setStyleSheet('color: %s' % self.text_color1)
        self.stats_pad1.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.stats_pad2.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.stats_pad3.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.stats_pad4.setStyleSheet('background-color: %s; border-radius: 10px' % self.pad_color)
        self.stats_mode_title1.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.pad_color, self.text_color1))
        self.stats_mode_title2.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.pad_color, self.text_color1))
        self.stats_mode_title3.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.pad_color, self.text_color1))
        self.stats_mode_title4.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.pad_color, self.text_color1))
        self.stats_bs1.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.stats_bs2.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.stats_bs3.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.stats_bt1.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.stats_bt2.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.stats_bt3.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.stats_ttm.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.stats_ac.setStyleSheet('background-color: %s; color: %s' % (self.pad_color, self.text_color1))
        self.stats_bs1_val.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.text_color1, self.text_color2))
        self.stats_bs2_val.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.text_color1, self.text_color2))
        self.stats_bs3_val.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.text_color1, self.text_color2))
        self.stats_bt1_val.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.text_color1, self.text_color2))
        self.stats_bt2_val.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.text_color1, self.text_color2))
        self.stats_bt3_val.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.text_color1, self.text_color2))
        self.stats_ttm_val.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.text_color1, self.text_color2))
        self.stats_ac_val.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.text_color1, self.text_color2))
        self.menu_pad.setStyleSheet("background-color: %s" % self.pad_color)
        self.menu_menu.setStyleSheet("background-color: %s; border-radius: 75px" % self.tile_color2)
        self.menu_txt.setStyleSheet("background-color: %s; color: %s" % (self.tile_color2, self.text_color1))
        self.menu_rnd.setStyleSheet("background-color: %s; border-radius: 60" % self.tile_color2)
        self.menu_game.setStyleSheet("background-color: rgba(0, 0, 0, 0.0); color: %s" % self.text_color1)
        self.menu_mode.setStyleSheet("background-color: rgba(0, 0, 0, 0.0); color: %s" % self.text_color1)
        self.menu_theme.setStyleSheet("background-color: rgba(0, 0, 0, 0.0); color: %s" % self.text_color1)
        self.menu_achievments.setStyleSheet("background-color: rgba(0, 0, 0, 0.0); color: %s" % self.text_color1)
        self.menu_rules.setStyleSheet("background-color: rgba(0, 0, 0, 0.0); color: %s" % self.text_color1)
        self.menu_stats.setStyleSheet("background-color: rgba(0, 0, 0, 0.0); color: %s" % self.text_color1)
        self.menu_game_h.setStyleSheet("background-color: %s; border-radius: 10px" % self.hollow_color)
        self.menu_mode_h.setStyleSheet("background-color: %s; border-radius: 10px" % self.hollow_color)
        self.menu_theme_h.setStyleSheet("background-color: %s; border-radius: 10px" % self.hollow_color)
        self.menu_achievments_h.setStyleSheet("background-color: %s; border-radius: 10px" % self.hollow_color)
        self.menu_rules_h.setStyleSheet("background-color: %s; border-radius: 10px" % self.hollow_color)
        self.menu_stats_h.setStyleSheet("background-color: %s; border-radius: 10px" % self.hollow_color)
        self.menu_exit.setStyleSheet("background-color: %s; color: %s; border-radius: 10px" % (self.tile_color32, self.text_color2))
        self.menu_tile.setStyleSheet("background-color: %s; border-radius: 10px" % self.tile_color2)
        self.menu_rnd.setPixmap(self.menu_btn_png)
        self.bg_plain.setStyleSheet("background-color: %s; border-radius: 10px" % self.pad_color)
        self.score_plain.setStyleSheet("background-color: %s; color: %s; border-radius: 10px" % (self.tile_color2, self.text_color1))
        self.score_value.setStyleSheet("background-color: %s; color: %s; border-radius: 10px" % (self.tile_color2, self.text_color2))
        self.best_plain.setStyleSheet("background-color: %s; color: %s; border-radius: 10px" % (self.tile_color2, self.text_color1))
        self.best_value.setStyleSheet("background-color: %s; color: %s; border-radius: 10px" % (self.tile_color2, self.text_color2))
        self.icon.setStyleSheet("color: %s" % self.text_color1)
        self.winlose_msg_pad.setStyleSheet("background-color: %s; border-radius: 10px" % self.pad_color)
        self.new_game_btn_panel.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.tile_color2, self.text_color1))
        self.change_mode_btn_panel.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.tile_color2, self.text_color1))
        self.continue_game_btn_panel.setStyleSheet('background-color: %s; color: %s; border-radius: 10px' % (self.tile_color2, self.text_color1))
        self.winlose_msg_text.setStyleSheet('background-color: rgba(0, 0, 0, 0.0); color: %s' % self.text_color2)
        self.achievments_check()
        for i in range(self.ysize):
            for j in range(self.xsize):
                self.hollows_lst[i][j][0].setStyleSheet("background-color: %s; border-radius: 10px" % self.hollow_color)
                if self.game_area[i][j][0] != None:
                        if self.game_area[i][j][2] < 8:
                            text_color = self.text_color1
                        else:
                            text_color = self.text_color2
                        if self.game_area[i][j][2] < 4096:
                            bg_color = self.color_dict[self.game_area[i][j][2]]
                        else:
                            bg_color = self.text_color1
                        self.game_area[i][j][0].setStyleSheet(f'background-color: {bg_color}; color: {text_color}; border-radius: 10')
                        self.game_area[i][j][0].setText(str(self.game_area[i][j][2]))
                        new_tile_font = self.tile_font
                        new_tile_font.setPointSize(44 - len(str(self.game_area[i][j][2])) * 4)
                        if new_tile_font.pointSize() < 10:
                            new_tile_font.setPointSize(10)
                        self.game_area[i][j][0].setFont(new_tile_font)

    def mode_window_init(self):
        self.mode_title = QLabel("выбор режима игры", self)
        self.mode_title.setFont(self.icon_font)
        self.mode_title.setAlignment(Qt.AlignBottom | Qt.AlignHCenter)
        self.mode_title.setGeometry(QRect(600, 50 - self.desk_h, 1200, 100))
        self.mode_pad1 = QWidget(self)
        self.mode_pad1.setGeometry(QRect(610, 200 - self.desk_h, 580, 280))
        self.mode_pad2 = QWidget(self)
        self.mode_pad2.setGeometry(QRect(1250, 200 - self.desk_h, 580, 280))
        self.mode_pad3 = QWidget(self)
        self.mode_pad3.setGeometry(QRect(610, 625 - self.desk_h, 580, 280))
        self.mode_pad4 = QWidget(self)
        self.mode_pad4.setGeometry(QRect(1250, 625 - self.desk_h, 580, 280))
        self.mode_mode1 = QLabel("4x4", self)
        self.mode_mode1.setFont(self.desc_font)
        self.mode_mode1.setAlignment(Qt.AlignVCenter | Qt.AlignHCenter)
        self.mode_mode1.setGeometry((QRect(650, 480 - self.desk_h, 500, 85)))
        self.mode_mode2 = QLabel("3x3", self)
        self.mode_mode2.setFont(self.desc_font)
        self.mode_mode2.setAlignment(Qt.AlignVCenter | Qt.AlignHCenter)
        self.mode_mode2.setGeometry((QRect(1290, 480 - self.desk_h, 500, 85)))
        self.mode_mode3 = QLabel("быстрая игра", self)
        self.mode_mode3.setFont(self.desc_font)
        self.mode_mode3.setAlignment(Qt.AlignVCenter | Qt.AlignHCenter)
        self.mode_mode3.setGeometry((QRect(650, 905 - self.desk_h, 500, 85)))
        self.mode_mode4 = QLabel("пользовательский", self)
        self.mode_mode4.setFont(self.desc_font)
        self.mode_mode4.setAlignment(Qt.AlignVCenter | Qt.AlignHCenter)
        self.mode_mode4.setGeometry((QRect(1290, 905 - self.desk_h, 500, 85)))
        self.mode_desc1 = QLabel("классический режим игры в 2048 со стандартным полем и правилами", self)
        self.mode_desc1.setFont(self.desc_font_mini)
        self.mode_desc1.setWordWrap(True)
        self.mode_desc1.setAlignment(Qt.AlignTop)
        self.mode_desc1.setGeometry((QRect(890, 225 - self.desk_h, 275, 230)))
        self.mode_desc2 = QLabel("проверьте свои способности на уменьшенном поле!", self)
        self.mode_desc2.setFont(self.desc_font_mini)
        self.mode_desc2.setWordWrap(True)
        self.mode_desc2.setAlignment(Qt.AlignTop)
        self.mode_desc2.setGeometry((QRect(890, 650 - self.desk_h, 275, 230)))
        self.mode_desc3 = QLabel("стандартное поле 4x4, но время на каждое действие ограничено!", self)
        self.mode_desc3.setFont(self.desc_font_mini)
        self.mode_desc3.setWordWrap(True)
        self.mode_desc3.setAlignment(Qt.AlignTop)
        self.mode_desc3.setGeometry((QRect(1535, 225 - self.desk_h, 275, 230)))
        self.mode_desc4 = QLabel("прямоугольное поле? считанные секунды на размышление? в этом режиме можно всё!", self)
        self.mode_desc4.setFont(self.desc_font_mini)
        self.mode_desc4.setWordWrap(True)
        self.mode_desc4.setAlignment(Qt.AlignTop)
        self.mode_desc4.setGeometry((QRect(1535, 650 - self.desk_h, 275, 230)))
        self.mode_img1 = QLabel(self)
        self.mode_img1.setGeometry((QRect(635, 225 - self.desk_h, 230, 230)))
        self.mode_img1.setStyleSheet('border-radius: 10px')
        self.mode_img2 = QLabel(self)
        self.mode_img2.setGeometry((QRect(635, 650 - self.desk_h, 230, 230)))
        self.mode_img2.setStyleSheet('border-radius: 10px')
        self.mode_img3 = QLabel(self)
        self.mode_img3.setGeometry((QRect(1275, 225 - self.desk_h, 230, 230)))
        self.mode_img3.setStyleSheet('border-radius: 10px')
        self.mode_img4 = QLabel(self)
        self.mode_img4.setGeometry((QRect(1275, 650 - self.desk_h, 230, 230)))
        self.mode_img4.setStyleSheet('border-radius: 10px')
        self.mode_btn1 = QPushButton(self)
        self.mode_btn1.setGeometry(QRect(610, 200 - self.desk_h, 580, 280))
        self.mode_btn1.clicked.connect(lambda: self.new_mode_start(0))
        self.mode_btn1.setStyleSheet('background-color: rgba(0, 0, 0, 0.0)')
        self.mode_btn2 = QPushButton(self)
        self.mode_btn2.setGeometry(QRect(1250, 200 - self.desk_h, 580, 280))
        self.mode_btn2.setStyleSheet('background-color: rgba(0, 0, 0, 0.0)')
        self.mode_btn2.clicked.connect(lambda: self.new_mode_start(1))
        self.mode_btn3 = QPushButton(self)
        self.mode_btn3.setGeometry(QRect(610, 625 - self.desk_h, 580, 280))
        self.mode_btn3.setStyleSheet('background-color: rgba(0, 0, 0, 0.0)')
        self.mode_btn3.clicked.connect(lambda: self.new_mode_start(2))
        self.mode_btn4 = QPushButton(self)
        self.mode_btn4.setGeometry(QRect(1250, 625 - self.desk_h, 580, 280))
        self.mode_btn4.setStyleSheet('background-color: rgba(0, 0, 0, 0.0)')
        self.mode_btn4.clicked.connect(lambda: self.new_mode_start(3))
        self.mode_widgets = (self.mode_title, self.mode_pad1, self.mode_pad2, self.mode_pad3, self.mode_pad4, 
                             self.mode_mode1, self.mode_mode2, self.mode_mode3, self.mode_mode4,
                             self.mode_desc1, self.mode_desc2, self.mode_desc3, self.mode_desc4,
                             self.mode_img1, self.mode_img2, self.mode_img3, self.mode_img4,
                             self.mode_btn1, self.mode_btn2, self.mode_btn3, self.mode_btn4)

    def theme_window_init(self):
        self.theme_title = QLabel("выбор цветовой темы", self)
        self.theme_title.setFont(self.icon_font)
        self.theme_title.setAlignment(Qt.AlignBottom | Qt.AlignHCenter)
        self.theme_title.setGeometry(QRect(600, 50 - self.desk_h, 1200, 100))
        self.theme1 = QLabel(self)
        self.theme1.setGeometry(QRect(940, 190 - self.desk_h, 550, 200))
        self.theme2 = QLabel(self)
        self.theme2.setGeometry(QRect(940, 500 - self.desk_h, 550, 200))
        self.theme3 = QLabel(self)
        self.theme3.setGeometry(QRect(940, 810 - self.desk_h, 550, 200))
        self.theme1_btn = QPushButton(self)
        self.theme1_btn.setStyleSheet("background-color: rgba(0, 0, 0, 0.0)")
        self.theme1_btn.setGeometry(QRect(940, 190 - self.desk_h, 550, 200))
        self.theme1_btn.clicked.connect(lambda: self.clr_change('classic'))
        self.theme2_btn = QPushButton(self)
        self.theme2_btn.setStyleSheet("background-color: rgba(0, 0, 0, 0.0)")
        self.theme2_btn.setGeometry(QRect(940, 500 - self.desk_h, 550, 200))
        self.theme2_btn.clicked.connect(lambda: self.clr_change('cold'))
        self.theme3_btn = QPushButton(self)
        self.theme3_btn.setStyleSheet("background-color: rgba(0, 0, 0, 0.0)")
        self.theme3_btn.setGeometry(QRect(940, 810 - self.desk_h, 550, 200))
        self.theme3_btn.clicked.connect(lambda: self.clr_change('gray'))
        self.theme1_title = QLabel('классическая', self)
        self.theme1_title.setFont(self.desc_font)
        self.theme1_title.setStyleSheet('color: #776e65')
        self.theme1_title.setGeometry(QRect(940, 400 - self.desk_h, 550, 60))
        self.theme1_title.setAlignment(Qt.AlignHCenter)
        self.theme2_title = QLabel('холодная', self)
        self.theme2_title.setFont(self.desc_font)
        self.theme2_title.setStyleSheet('color: #657477')
        self.theme2_title.setGeometry(QRect(940, 710 - self.desk_h, 550, 60))
        self.theme2_title.setAlignment(Qt.AlignHCenter)
        self.theme3_title = QLabel('оттенки серого', self)
        self.theme3_title.setFont(self.desc_font)
        self.theme3_title.setStyleSheet('color: #464646')
        self.theme3_title.setGeometry(QRect(940, 1020 - self.desk_h, 550, 60))
        self.theme3_title.setAlignment(Qt.AlignHCenter)
        self.theme_widgets = (self.theme_title, self.theme1, self.theme2, self.theme3, 
                              self.theme1_title, self.theme2_title, self.theme3_title,
                              self.theme1_btn, self.theme2_btn, self.theme3_btn)

    def achievments_window_init(self):
        self.achievments_title = QLabel("достижения", self)
        self.achievments_title.setFont(self.icon_font)
        self.achievments_title.setAlignment(Qt.AlignBottom | Qt.AlignHCenter)
        self.achievments_title.setGeometry(QRect(600, 50 - self.desk_h, 1200, 100))
        self.achiev1_pad = QWidget(self)
        self.achiev1_pad.setGeometry(QRect(640, 200 - self.desk_h, 500, 150))
        self.achiev2_pad = QWidget(self)
        self.achiev2_pad.setGeometry(QRect(640, 410 - self.desk_h, 500, 150))
        self.achiev3_pad = QWidget(self)
        self.achiev3_pad.setGeometry(QRect(640, 620 - self.desk_h, 500, 150))
        self.achiev4_pad = QWidget(self)
        self.achiev4_pad.setGeometry(QRect(640, 830 - self.desk_h, 500, 150))
        self.achiev5_pad = QWidget(self)
        self.achiev5_pad.setGeometry(QRect(1280, 200 - self.desk_h, 500, 150))
        self.achiev6_pad = QWidget(self)
        self.achiev6_pad.setGeometry(QRect(1280, 410 - self.desk_h, 500, 150))
        self.achiev7_pad = QWidget(self)
        self.achiev7_pad.setGeometry(QRect(1280, 620 - self.desk_h, 500, 150))
        self.achiev8_pad = QWidget(self)
        self.achiev8_pad.setGeometry(QRect(1280, 830 - self.desk_h, 500, 150))
        self.achiev1_title = QLabel('первые шаги', self)
        self.achiev1_title.setAlignment(Qt.AlignTop)
        self.achiev1_title.setFont(self.achiev_font)
        self.achiev1_title.setGeometry(QRect(790, 205 - self.desk_h, 345, 70))
        self.achiev2_title = QLabel('первые успехи', self)
        self.achiev2_title.setAlignment(Qt.AlignTop)
        self.achiev2_title.setFont(self.achiev_font)
        self.achiev2_title.setGeometry(QRect(790, 415 - self.desk_h, 345, 70))
        self.achiev3_title = QLabel('первая победа', self)
        self.achiev3_title.setAlignment(Qt.AlignTop)
        self.achiev3_title.setFont(self.achiev_font)
        self.achiev3_title.setGeometry(QRect(790, 625 - self.desk_h, 345, 70))
        self.achiev4_title = QLabel('сверх нормы', self)
        self.achiev4_title.setAlignment(Qt.AlignTop)
        self.achiev4_title.setFont(self.achiev_font)
        self.achiev4_title.setGeometry(QRect(790, 835 - self.desk_h, 345, 70))
        self.achiev5_title = QLabel('это было сложно', self)
        self.achiev5_title.setAlignment(Qt.AlignTop)
        self.achiev5_title.setFont(self.achiev_font)
        self.achiev5_title.setGeometry(QRect(1430, 205 - self.desk_h, 345, 70))
        self.achiev6_title = QLabel('это было быстро', self)
        self.achiev6_title.setAlignment(Qt.AlignTop)
        self.achiev6_title.setFont(self.achiev_font)
        self.achiev6_title.setGeometry(QRect(1430, 415 - self.desk_h, 345, 70))
        self.achiev7_title = QLabel('мастер плиток', self)
        self.achiev7_title.setAlignment(Qt.AlignTop)
        self.achiev7_title.setFont(self.achiev_font)
        self.achiev7_title.setGeometry(QRect(1430, 625 - self.desk_h, 345, 70))
        self.achiev8_2_title = QLabel('миллионером?', self)
        self.achiev8_2_title.setAlignment(Qt.AlignTop)
        self.achiev8_2_title.setFont(self.achiev_font_mini)
        self.achiev8_2_title.setGeometry(QRect(1430, 862 - self.desk_h, 345, 35))
        self.achiev8_title = QLabel('а кто не хочет стать', self)
        self.achiev8_title.setAlignment(Qt.AlignTop)
        self.achiev8_title.setFont(self.achiev_font_mini)
        self.achiev8_title.setGeometry(QRect(1430, 835 - self.desk_h, 345, 35))
        self.achiev1_ico = QLabel('8', self)
        self.achiev1_ico.setFont(self.tile_font5)
        self.achiev1_ico.setGeometry(QRect(650, 210 - self.desk_h, 120, 120))
        self.achiev1_ico.setAlignment(Qt.AlignHCenter | Qt.AlignVCenter)
        self.achiev2_ico = QLabel('128', self)
        self.achiev2_ico.setFont(self.tile_font2)
        self.achiev2_ico.setGeometry(QRect(650, 420 - self.desk_h, 120, 120))
        self.achiev2_ico.setAlignment(Qt.AlignHCenter | Qt.AlignVCenter)
        self.achiev3_ico = QLabel('2048', self)
        self.achiev3_ico.setFont(self.tile_font3)
        self.achiev3_ico.setGeometry(QRect(650, 630 - self.desk_h, 120, 120))
        self.achiev3_ico.setAlignment(Qt.AlignHCenter | Qt.AlignVCenter)
        self.achiev4_ico = QLabel('4096', self)
        self.achiev4_ico.setFont(self.tile_font3)
        self.achiev4_ico.setGeometry(QRect(650, 840 - self.desk_h, 120, 120))
        self.achiev4_ico.setAlignment(Qt.AlignHCenter | Qt.AlignVCenter)
        self.achiev5_ico = QLabel('512', self)
        self.achiev5_ico.setFont(self.tile_font2)
        self.achiev5_ico.setGeometry(QRect(1290, 210 - self.desk_h, 120, 120))
        self.achiev5_ico.setAlignment(Qt.AlignHCenter | Qt.AlignVCenter)
        self.achiev6_ico = QLabel('2048', self)
        self.achiev6_ico.setFont(self.tile_font3)
        self.achiev6_ico.setGeometry(QRect(1290, 420 - self.desk_h, 120, 120))
        self.achiev6_ico.setAlignment(Qt.AlignHCenter | Qt.AlignVCenter)
        self.achiev7_ico = QLabel('100 000', self)
        self.achiev7_ico.setFont(self.tile_font3)
        self.achiev7_ico.setGeometry(QRect(1290, 630 - self.desk_h, 120, 120))
        self.achiev7_ico.setAlignment(Qt.AlignHCenter | Qt.AlignVCenter)
        self.achiev7_ico.setWordWrap(True)
        self.achiev8_ico = QLabel('1000 000', self)
        self.achiev8_ico.setFont(self.tile_font4)
        self.achiev8_ico.setGeometry(QRect(1290, 840 - self.desk_h, 120, 120))
        self.achiev8_ico.setAlignment(Qt.AlignHCenter | Qt.AlignVCenter)
        self.achiev8_ico.setWordWrap(True)
        self.achiev1_desc = QLabel('соберите плитку номиналом 8 в режиме “4x4”', self)
        self.achiev1_desc.setWordWrap(True)
        self.achiev1_desc.setFont(self.achiev_desc_font)
        self.achiev1_desc.setGeometry(QRect(790, 250 - self.desk_h, 320, 90))
        self.achiev1_desc.setAlignment(Qt.AlignLeft | Qt.AlignTop)
        self.achiev2_desc = QLabel('соберите плитку номиналом 128 в режиме “4x4”', self)
        self.achiev2_desc.setWordWrap(True)
        self.achiev2_desc.setFont(self.achiev_desc_font)
        self.achiev2_desc.setGeometry(QRect(790, 460 - self.desk_h, 320, 90))
        self.achiev2_desc.setAlignment(Qt.AlignLeft | Qt.AlignTop)
        self.achiev3_desc = QLabel('соберите плитку номиналом 2048 в режиме “4x4”', self)
        self.achiev3_desc.setWordWrap(True)
        self.achiev3_desc.setFont(self.achiev_desc_font)
        self.achiev3_desc.setGeometry(QRect(790, 670 - self.desk_h, 320, 90))
        self.achiev3_desc.setAlignment(Qt.AlignLeft | Qt.AlignTop)
        self.achiev4_desc = QLabel('соберите плитку номиналом 4096 в режиме “4x4”', self)
        self.achiev4_desc.setWordWrap(True)
        self.achiev4_desc.setFont(self.achiev_desc_font)
        self.achiev4_desc.setGeometry(QRect(790, 880 - self.desk_h, 320, 90))
        self.achiev4_desc.setAlignment(Qt.AlignLeft | Qt.AlignTop)
        self.achiev5_desc = QLabel('соберите плитку номиналом 512 в режиме “3x3”', self)
        self.achiev5_desc.setWordWrap(True)
        self.achiev5_desc.setFont(self.achiev_desc_font)
        self.achiev5_desc.setGeometry(QRect(1430, 250 - self.desk_h, 320, 90))
        self.achiev5_desc.setAlignment(Qt.AlignLeft | Qt.AlignTop)
        self.achiev6_desc = QLabel('соберите плитку номиналом 2048 в режиме “быстрая игра”', self)
        self.achiev6_desc.setWordWrap(True)
        self.achiev6_desc.setFont(self.achiev_desc_font)
        self.achiev6_desc.setGeometry(QRect(1430, 460 - self.desk_h, 320, 90))
        self.achiev6_desc.setAlignment(Qt.AlignLeft | Qt.AlignTop)
        self.achiev7_desc = QLabel('сложите суммарно 100 000 плиток в режимах “4x4”, “3x3” и “быстрая игра”', self)
        self.achiev7_desc.setWordWrap(True)
        self.achiev7_desc.setFont(self.achiev_desc_font)
        self.achiev7_desc.setGeometry(QRect(1430, 670 - self.desk_h, 320, 90))
        self.achiev7_desc.setAlignment(Qt.AlignLeft | Qt.AlignTop)
        self.achiev8_desc = QLabel('достигните счёта 1 000 000 в режиме “4x4” или “быстрая игра”', self)
        self.achiev8_desc.setWordWrap(True)
        self.achiev8_desc.setFont(self.achiev_desc_font)
        self.achiev8_desc.setGeometry(QRect(1430, 900 - self.desk_h, 320, 70))
        self.achiev8_desc.setAlignment(Qt.AlignLeft | Qt.AlignTop)
        self.achievment_msg_pad = QWidget(self)
        self.achievment_msg_pad.setGeometry(QRect(1360, self.desk_h + 150, 500, 150))
        self.achievment_msg_text = QLabel('получено новое достижение',self)
        self.achievment_msg_text.setWordWrap(True)
        self.achievment_msg_text.setFont(self.tile_font4)
        self.achievment_msg_text.setGeometry(QRect(1520, self.desk_h + 175, 330, 100))
        self.achievment_msg_tile = QLabel('!', self)
        self.achievment_msg_tile.setAlignment(Qt.AlignHCenter | Qt.AlignHCenter)
        self.achievment_msg_tile.setFont(self.tile_font)
        self.achievment_msg_tile.setGeometry(QRect(1385, self.desk_h + 175, 100, 100))
        self.achievment_msg = [self.achievment_msg_pad, self.achievment_msg_text, self.achievment_msg_tile]
        self.achievments_dict = {
            self.achiev1_ico: False,
            self.achiev2_ico: False,
            self.achiev3_ico: False,
            self.achiev4_ico: False,
            self.achiev5_ico: False,
            self.achiev6_ico: False,
            self.achiev7_ico: False,
            self.achiev8_ico: False,
        }
        self.achievments_widgets = (self.achievments_title, self.achiev1_pad, self.achiev2_pad, self.achiev3_pad, self.achiev4_pad, self.achiev5_pad, self.achiev6_pad, self.achiev7_pad, self.achiev8_pad,
                                    self.achiev1_title, self.achiev2_title, self.achiev3_title, self.achiev4_title, self.achiev5_title, self.achiev6_title, self.achiev7_title, self.achiev8_title, self.achiev8_2_title,
                                    self.achiev1_ico, self.achiev2_ico, self.achiev3_ico, self.achiev4_ico, self.achiev5_ico, self.achiev6_ico, self.achiev7_ico, self.achiev8_ico,
                                    self.achiev1_desc, self.achiev2_desc, self.achiev3_desc, self.achiev4_desc, self.achiev5_desc, self.achiev6_desc, self.achiev7_desc, self.achiev8_desc)
    
    def rules_window_init(self):
        self.rules_title = QLabel('правила', self)
        self.rules_title.setFont(self.icon_font)
        self.rules_title.setAlignment(Qt.AlignBottom | Qt.AlignHCenter)
        self.rules_title.setGeometry(QRect(600, 50 - self.desk_h, 1200, 100))
        self.rules_rules = QLabel("""
    используйте стрелки или клавиши WASD на клавиатуре, чтобы перемещать плитки                      
    когда две плитки с одинаковыми числами соприкасаются, они сливаются в одну, чей номинал равен сумме исходных плиток                    
    когда всё игровое поле заполнено плитками и новое действие более невозможно, игра заканчивается                       
    особенности режимов игры:               
    4x4: цель - собрать плитку номиналом 2048         
    3x3: цель - собрать плитку номиналом 512           
    быстрая игра: цель - собрать плитку номиналом 2048, на каждое действие отводится 3 секунды, по истчении которых игра заканчивается               
    пользовательский: произвольный выбор цели (от 4 до 131072), номиналов появляющихся плиток (от 2 до 4096) и шансов их появления (от 0 до 100), ограничения по времени (от 1 до 60) и размеров игрового поля (от 3 до 6)
    при желании Вы можете продолжить играть после достижения основной цели в любом из режимов
        """, self)
        self.rules_rules.setGeometry(QRect(515, 150 - self.desk_h, 1400, 940))
        self.rules_rules.setWordWrap(True)
        self.rules_rules.setFont(self.tile_font3)
        self.rules_widgets = (self.rules_title, self.rules_rules)

    def stats_window_init(self):
        self.stats_title = QLabel('статистика', self)
        self.stats_title.setFont(self.icon_font)
        self.stats_title.setAlignment(Qt.AlignBottom | Qt.AlignHCenter)
        self.stats_title.setGeometry(QRect(600, 50 - self.desk_h, 1200, 100))
        self.stats_pad1 = QWidget(self)
        self.stats_pad1.setGeometry(QRect(550, 200 - self.desk_h, 650, 350))
        self.stats_pad2 = QWidget(self)
        self.stats_pad2.setGeometry(QRect(550, 570 - self.desk_h, 650, 350))
        self.stats_pad3 = QWidget(self)
        self.stats_pad3.setGeometry(QRect(1220, 200 - self.desk_h, 650, 350))
        self.stats_pad4 = QWidget(self)
        self.stats_pad4.setGeometry(QRect(1220, 570 - self.desk_h, 650, 350))
        self.stats_mode_title1 = QLabel('4x4', self)
        self.stats_mode_title1.setFont(self.icon_font_mini)
        self.stats_mode_title1.setAlignment(Qt.AlignHCenter)
        self.stats_mode_title1.setGeometry(QRect(550, 200 - self.desk_h, 650, 100))
        self.stats_mode_title2 = QLabel('3x3', self)
        self.stats_mode_title2.setFont(self.icon_font_mini)
        self.stats_mode_title2.setAlignment(Qt.AlignHCenter)
        self.stats_mode_title2.setGeometry(QRect(550, 570 - self.desk_h, 650, 100))
        self.stats_mode_title3 = QLabel('быстрая игра', self)
        self.stats_mode_title3.setFont(self.icon_font_mini)
        self.stats_mode_title3.setAlignment(Qt.AlignHCenter)
        self.stats_mode_title3.setGeometry(QRect(1220, 200 - self.desk_h, 650, 100))
        self.stats_mode_title4 = QLabel('общее', self)
        self.stats_mode_title4.setFont(self.icon_font_mini)
        self.stats_mode_title4.setAlignment(Qt.AlignHCenter)
        self.stats_mode_title4.setGeometry(QRect(1220, 570 - self.desk_h, 650, 100))
        self.stats_bs1 = QLabel('лучший счёт:', self)
        self.stats_bs1.setFont(self.tile_font3)
        self.stats_bs1.setAlignment(Qt.AlignVCenter)
        self.stats_bs1.setGeometry(QRect(575, 300 - self.desk_h, 330, 80))
        self.stats_bs2 = QLabel('лучший счёт:', self)
        self.stats_bs2.setFont(self.tile_font3)
        self.stats_bs2.setAlignment(Qt.AlignVCenter)
        self.stats_bs2.setGeometry(QRect(575, 675 - self.desk_h, 330, 80))
        self.stats_bs3 = QLabel('лучший счёт:', self)
        self.stats_bs3.setFont(self.tile_font3)
        self.stats_bs3.setAlignment(Qt.AlignVCenter)
        self.stats_bs3.setGeometry(QRect(1250, 300 - self.desk_h, 330, 80))
        self.stats_bt1 = QLabel('лучшая плитка:', self)
        self.stats_bt1.setFont(self.tile_font3)
        self.stats_bt1.setAlignment(Qt.AlignVCenter)
        self.stats_bt1.setGeometry(QRect(575, 425 - self.desk_h, 330, 80))
        self.stats_bt2 = QLabel('лучшая плитка:', self)
        self.stats_bt2.setFont(self.tile_font3)
        self.stats_bt2.setAlignment(Qt.AlignVCenter)
        self.stats_bt2.setGeometry(QRect(575, 800 - self.desk_h, 330, 80))
        self.stats_bt3 = QLabel('лучшая плитка:', self)
        self.stats_bt3.setFont(self.tile_font3)
        self.stats_bt3.setAlignment(Qt.AlignVCenter)
        self.stats_bt3.setGeometry(QRect(1250, 425 - self.desk_h, 330, 80))
        self.stats_ttm = QLabel('сложено плиток:', self)
        self.stats_ttm.setFont(self.tile_font3)
        self.stats_ttm.setAlignment(Qt.AlignVCenter)
        self.stats_ttm.setGeometry(QRect(1250, 675 - self.desk_h, 360, 80))
        self.stats_ac = QLabel('получено достижений:', self)
        self.stats_ac.setFont(self.tile_font3)
        self.stats_ac.setAlignment(Qt.AlignVCenter)
        self.stats_ac.setGeometry(QRect(1250, 800 - self.desk_h, 480, 80))
        self.stats_bs1_val = QLabel(' 0', self)
        self.stats_bs1_val.setFont(self.tile_font3)
        self.stats_bs1_val.setAlignment(Qt.AlignVCenter)
        self.stats_bs1_val.setGeometry(QRect(875, 300 - self.desk_h, 300, 80))
        self.stats_bs2_val = QLabel(' 0', self)
        self.stats_bs2_val.setFont(self.tile_font3)
        self.stats_bs2_val.setAlignment(Qt.AlignVCenter)
        self.stats_bs2_val.setGeometry(QRect(875, 675 - self.desk_h, 300, 80))
        self.stats_bs3_val = QLabel(' 0', self)
        self.stats_bs3_val.setFont(self.tile_font3)
        self.stats_bs3_val.setAlignment(Qt.AlignVCenter)
        self.stats_bs3_val.setGeometry(QRect(1550, 300 - self.desk_h, 300, 80))
        self.stats_bt1_val = QLabel(' 0', self)
        self.stats_bt1_val.setFont(self.tile_font3)
        self.stats_bt1_val.setAlignment(Qt.AlignVCenter)
        self.stats_bt1_val.setGeometry(QRect(925, 425 - self.desk_h, 250, 80))
        self.stats_bt2_val = QLabel(' 0', self)
        self.stats_bt2_val.setFont(self.tile_font3)
        self.stats_bt2_val.setAlignment(Qt.AlignVCenter)
        self.stats_bt2_val.setGeometry(QRect(925, 800 - self.desk_h, 250, 80))
        self.stats_bt3_val = QLabel(' 0', self)
        self.stats_bt3_val.setFont(self.tile_font3)
        self.stats_bt3_val.setAlignment(Qt.AlignVCenter)
        self.stats_bt3_val.setGeometry(QRect(1600, 425 - self.desk_h, 250, 80))
        self.stats_ttm_val = QLabel(' 0', self)
        self.stats_ttm_val.setFont(self.tile_font3)
        self.stats_ttm_val.setAlignment(Qt.AlignVCenter)
        self.stats_ttm_val.setGeometry(QRect(1620, 675 - self.desk_h, 230, 80))
        self.stats_ac_val = QLabel(' 0', self)
        self.stats_ac_val.setFont(self.tile_font3)
        self.stats_ac_val.setAlignment(Qt.AlignVCenter)
        self.stats_ac_val.setGeometry(QRect(1740, 800 - self.desk_h, 110, 80))
        self.stats_widgets = (self.stats_title, self.stats_pad1, self.stats_pad2, self.stats_pad3, self.stats_pad4,
                              self.stats_mode_title1, self.stats_mode_title2, self.stats_mode_title3, self.stats_mode_title4,
                              self.stats_bs1, self.stats_bs2, self.stats_bs3, self.stats_ttm, 
                              self.stats_bt1, self.stats_bt2, self.stats_bt3, self.stats_ac,
                              self.stats_bs1_val, self.stats_bs2_val, self.stats_bs3_val, self.stats_ttm_val, 
                              self.stats_bt1_val, self.stats_bt2_val, self.stats_bt3_val, self.stats_ac_val)
        
    def menu_init(self):
        self.menu_font = self.fonts_parent.font()
        self.menu_font.setPointSize(30)
        self.menu_font.setBold(True)
        self.menu_pad = QWidget(self)
        self.menu_pad.setGeometry(-350, 0, 500, self.desk_h)
        self.menu_menu = QWidget(self)
        self.menu_menu.setGeometry(-450, 25, 600, 150)
        self.menu_txt = QLabel('меню', self)
        self.menu_txt.setGeometry(-350, 50, 350, 100)
        self.menu_txt.setFont(self.icon_font)
        self.menu_txt.setAlignment(Qt.AlignBottom | Qt.AlignHCenter)
        self.menu_rnd = QLabel(self)
        self.menu_rnd.setGeometry(10, 40, 120, 120)
        self.menu_btn = QPushButton(self)
        self.menu_btn.setGeometry(-450, 25, 600, 150)
        self.menu_btn.clicked.connect(self.move_menu)
        self.menu_btn.setStyleSheet('background-color: rgba(0, 0, 0, 0.0)')
        self.menu_game_h = QWidget(self)
        self.menu_mode_h = QWidget(self)
        self.menu_theme_h = QWidget(self)
        self.menu_achievments_h = QWidget(self)
        self.menu_rules_h = QWidget(self)
        self.menu_stats_h = QWidget(self)
        self.menu_tile = QWidget(self)
        self.menu_game = QPushButton(self, text='игра')
        self.menu_mode = QPushButton(self, text='режим')
        self.menu_theme = QPushButton(self, text='тема')
        self.menu_achievments = QPushButton(self, text='достижения')
        self.menu_rules = QPushButton(self, text='правила')
        self.menu_stats = QPushButton(self, text='статистика')
        self.menu_exit = QPushButton(self, text='выход')
        self.menu_game.clicked.connect(lambda: self.window_change(0))
        self.menu_mode.clicked.connect(lambda: self.window_change(1))
        self.menu_theme.clicked.connect(lambda: self.window_change(2))
        self.menu_achievments.clicked.connect(lambda: self.window_change(3))
        self.menu_rules.clicked.connect(lambda: self.window_change(4))
        self.menu_stats.clicked.connect(lambda: self.window_change(5))
        self.menu_exit.clicked.connect(self.close)
        self.menu_game.setFont(self.menu_font)
        self.menu_mode.setFont(self.menu_font)
        self.menu_theme.setFont(self.menu_font)
        self.menu_achievments.setFont(self.menu_font)
        self.menu_rules.setFont(self.menu_font)
        self.menu_stats.setFont(self.menu_font)
        self.menu_exit.setFont(self.menu_font)
        self.menu_game.setGeometry(-475, 200, 450, 100)
        self.menu_mode.setGeometry(-475, 325, 450, 100)
        self.menu_theme.setGeometry(-475, 450, 450, 100)
        self.menu_achievments.setGeometry(-475, 575, 450, 100)
        self.menu_rules.setGeometry(-475, 700, 450, 100)
        self.menu_stats.setGeometry(-475, 825, 450, 100)
        self.menu_exit.setGeometry(-395, 975, 300, 100)
        self.menu_tile.setGeometry(-475, 200, 450, 100)
        self.menu_game_h.setGeometry(-475, 200, 450, 100)
        self.menu_mode_h.setGeometry(-475, 325, 450, 100)
        self.menu_theme_h.setGeometry(-475, 450, 450, 100)
        self.menu_achievments_h.setGeometry(-475, 575, 450, 100)
        self.menu_rules_h.setGeometry(-475, 700, 450, 100)
        self.menu_stats_h.setGeometry(-475, 825, 450, 100)
        self.menu_widgets = (self.menu_menu, self.menu_btn, self.menu_pad, self.menu_rnd, self.menu_txt)
        self.menu_points = (self.menu_game, self.menu_mode, self.menu_theme, self.menu_achievments, self.menu_rules, self.menu_stats,
                            self.menu_game_h, self.menu_mode_h, self.menu_theme_h, self.menu_achievments_h, self.menu_rules_h, self.menu_stats_h,
                            self.menu_exit, self.menu_tile)

    def new_mode_start(self, mode):
        if self.isWindowAnimEnd:
                self.game_window_del()
                self.choose_mode(mode)
                self.game_window_init_new()
                self.game_window_show() 

    def window_change(self, newwin):
        if self.curwin != newwin and self.menu_btn.isEnabled():
            self.newwin = newwin
            for btn in self.windows_btns:
                btn.setDisabled(True)
            window_anim_group = QParallelAnimationGroup(self)
            for widget in self.windows[self.curwin]:
                if isinstance(widget, list):
                    for i in range(self.ysize):
                        for j in range(self.xsize):
                            window_anim = QPropertyAnimation(widget[i][j][0], b"pos")
                            window_anim.setEasingCurve(QEasingCurve.OutCubic)
                            window_anim.setEndValue(QPoint(widget[i][j][0].x(), widget[i][j][0].y() + self.desk_h))
                            window_anim.setDuration(400)
                            window_anim_group.addAnimation(window_anim)
                else:
                    window_anim = QPropertyAnimation(widget, b"pos")
                    window_anim.setEasingCurve(QEasingCurve.OutCubic)
                    window_anim.setEndValue(QPoint(widget.x(), widget.y() + self.desk_h))
                    window_anim.setDuration(400)
                    window_anim_group.addAnimation(window_anim)
            for widget in self.windows[newwin]:
                if isinstance(widget, list):
                    for i in range(self.ysize):
                        for j in range(self.xsize):
                            window_anim = QPropertyAnimation(widget[i][j][0], b"pos")
                            window_anim.setEasingCurve(QEasingCurve.OutCubic)
                            window_anim.setEndValue(QPoint(widget[i][j][0].x(), widget[i][j][0].y() + self.desk_h))
                            window_anim.setDuration(400)
                            window_anim_group.addAnimation(window_anim)
                else: 
                    window_anim = QPropertyAnimation(widget, b"pos")
                    window_anim.setEasingCurve(QEasingCurve.OutCubic)
                    window_anim.setEndValue(QPoint(widget.x(), widget.y() + self.desk_h))
                    window_anim.setDuration(400)
                    window_anim_group.addAnimation(window_anim)
            menu_tile_anim = QPropertyAnimation(self.menu_tile, b"pos")
            menu_tile_anim.setEasingCurve(QEasingCurve.OutCubic)
            menu_tile_anim.setEndValue(QPoint(self.menu_tile.x(), 200 + 125 * newwin))
            menu_tile_anim.setDuration(400)
            window_anim_group.addAnimation(menu_tile_anim)
            self.isWindowAnimEnd = False
            window_anim_group.start()
            self.window_timer.start()

    def move_window(self):
        for btn in self.windows_btns:
            btn.setDisabled(False)
        window_anim_group = QParallelAnimationGroup(self)
        for widget in self.windows[self.curwin]:
            if isinstance(widget, list):
                for i in range(self.ysize):
                    for j in range(self.xsize):
                        window_anim = QPropertyAnimation(widget[i][j][0], b"pos")
                        window_anim.setEndValue(QPoint(widget[i][j][0].x(), widget[i][j][0].y() - 2 * self.desk_h))
                        window_anim.setDuration(0)
                        window_anim_group.addAnimation(window_anim)
            else:
                window_anim = QPropertyAnimation(widget, b"pos")
                window_anim.setEndValue(QPoint(widget.x(), widget.y() - 2 * self.desk_h))
                window_anim.setDuration(0)
                window_anim_group.addAnimation(window_anim)
        window_anim_group.start()
        self.curwin = self.newwin
        self.window_timer.stop()
        self.isWindowAnimEnd = True
            
    def move_menu(self):
        if self.isMovingAble and self.isWindowAnimEnd:
            self.isMenuActive = not self.isMenuActive
            menu_anim_group = QParallelAnimationGroup(self)
            if not self.isMenuActive:
                shift1 = -350
                shift2 = -500
            else:
                shift1 = 350
                shift2 = 500
            for widget in self.menu_widgets:
                menu_anim = QPropertyAnimation(widget, b"pos")
                menu_anim.setEasingCurve(QEasingCurve.OutCubic)
                menu_anim.setEndValue(QPoint(widget.x() + shift1, widget.y()))
                menu_anim.setDuration(300)
                menu_anim_group.addAnimation(menu_anim)
            for widget in self.menu_points:
                menu_anim = QPropertyAnimation(widget, b"pos")
                menu_anim.setEasingCurve(QEasingCurve.OutCubic)
                menu_anim.setEndValue(QPoint(widget.x() + shift2, widget.y()))
                menu_anim.setDuration(400)
                menu_anim_group.addAnimation(menu_anim)
            for widget in self.windows[self.curwin]:
                if isinstance(widget, list):
                    for i in range(self.ysize):
                        for j in range(self.xsize):
                            window_anim = QPropertyAnimation(widget[i][j][0], b"pos")
                            window_anim.setEasingCurve(QEasingCurve.OutCubic)
                            window_anim.setEndValue(QPoint(widget[i][j][0].x() + shift1 // 2, widget[i][j][0].y()))
                            window_anim.setDuration(400)
                            menu_anim_group.addAnimation(window_anim)
                else:
                    window_anim = QPropertyAnimation(widget, b"pos")
                    window_anim.setEasingCurve(QEasingCurve.OutCubic)
                    window_anim.setEndValue(QPoint(widget.x() + shift1 // 2, widget.y()))
                    window_anim.setDuration(400)
                    menu_anim_group.addAnimation(window_anim)
            menu_anim_group.start()
            self.menu_btn.setEnabled(False)
            self.menu_timer.start()

    def get_game_state(self):
        for i in range(self.ysize):
            for j in range(self.xsize):
                if self.game_area[i][j][2] == self.winnomin:
                    return 'win'
        for i in range(self.ysize):
            for j in range(self.xsize):
                if self.game_area[i][j][0] == None:
                    return 'continue'
                if j < self.xsize - 1:
                    if self.game_area[i][j][2] == self.game_area[i][j + 1][2]:
                        return 'continue'
                if i < self.ysize - 1:
                    if self.game_area[i][j][2] == self.game_area[i + 1][j][2]:
                        return 'continue'
        return 'end'
    
    def move_tiles(self, direction: str):
        if direction == 'left':
            for i in range(self.ysize):
                for j in range(1, self.xsize):
                    new_pos = j - 1
                    if self.game_area[i][j][0] == None:
                        continue
                    while new_pos != -1 and self.game_area[i][new_pos][0] == None:
                        new_pos -= 1
                    if new_pos == -1 or self.game_area[i][new_pos][2] != self.game_area[i][j][2]:
                        new_pos += 1
                        self.game_area[i][new_pos] = self.game_area[i][j]
                        if new_pos != j:
                            self.game_area[i][j] = [None, None, 2]
                            self.changes = True
                    else:
                        if self.game_area[i][new_pos][1] == None:
                            self.game_area[i][new_pos][1] = self.game_area[i][j][0]
                            self.game_area[i][new_pos][2] *= 2
                            self.score += self.game_area[i][new_pos][2]
                            self.merge_cnt += 1
                            self.game_area[i][j] = [None, None, 2]
                            self.changes = True
                        else:
                            new_pos += 1
                            self.game_area[i][new_pos] = self.game_area[i][j]
                            self.game_area[i][j] = [None, None, 2]
                            self.changes = True

        if direction == 'right':
            for i in range(self.ysize):
                for j in range(self.xsize - 2, -1, -1):
                    new_pos = j + 1
                    if self.game_area[i][j][0] == None:
                        continue
                    while new_pos != self.xsize and self.game_area[i][new_pos][0] == None:
                        new_pos += 1
                    if new_pos == self.xsize or self.game_area[i][new_pos][2] != self.game_area[i][j][2]:
                        new_pos -= 1
                        self.game_area[i][new_pos] = self.game_area[i][j]
                        if new_pos != j:
                            self.game_area[i][j] = [None, None, 2]
                            self.changes = True
                    else:
                        if self.game_area[i][new_pos][1] == None:
                            self.game_area[i][new_pos][1] = self.game_area[i][j][0]
                            self.game_area[i][new_pos][2] *= 2
                            self.score += self.game_area[i][new_pos][2]
                            self.merge_cnt += 1
                            self.game_area[i][j] = [None, None, 2]
                            self.changes = True
                        else:
                            new_pos -= 1
                            self.game_area[i][new_pos] = self.game_area[i][j]
                            self.game_area[i][j] = [None, None, 2]
                            self.changes = True

        if direction == 'up':
            for j in range(self.xsize):
                for i in range(1, self.ysize):
                    new_pos = i - 1
                    if self.game_area[i][j][0] == None:
                        continue
                    while new_pos != -1 and self.game_area[new_pos][j][0] == None:
                        new_pos -= 1
                    if new_pos == -1 or self.game_area[new_pos][j][2] != self.game_area[i][j][2]:
                        new_pos += 1
                        self.game_area[new_pos][j] = self.game_area[i][j]
                        if new_pos != i:
                            self.game_area[i][j] = [None, None, 2]
                            self.changes = True
                    else:
                        if self.game_area[new_pos][j][1] == None:
                            self.game_area[new_pos][j][1] = self.game_area[i][j][0]
                            self.game_area[new_pos][j][2] *= 2
                            self.score += self.game_area[new_pos][j][2]
                            self.merge_cnt += 1
                            self.game_area[i][j] = [None, None, 2]
                            self.changes = True
                        else:
                            new_pos += 1
                            self.game_area[new_pos][j] = self.game_area[i][j]
                            self.game_area[i][j] = [None, None, 2]
                            self.changes = True

        if direction == 'down':
            for j in range(self.xsize):
                for i in range(self.ysize - 2, -1, -1):
                    new_pos = i + 1
                    if self.game_area[i][j][0] == None:
                        continue
                    while new_pos != self.ysize and self.game_area[new_pos][j][0] == None:
                        new_pos += 1
                    if new_pos == self.ysize or self.game_area[new_pos][j][2] != self.game_area[i][j][2]:
                        new_pos -= 1
                        self.game_area[new_pos][j] = self.game_area[i][j]
                        if new_pos != i:
                            self.game_area[i][j] = [None, None, 2]
                            self.changes = True
                    else:
                        if self.game_area[new_pos][j][1] == None:
                            self.game_area[new_pos][j][1] = self.game_area[i][j][0]
                            self.game_area[new_pos][j][2] *= 2
                            self.score += self.game_area[new_pos][j][2]
                            self.merge_cnt += 1
                            self.game_area[i][j] = [None, None, 2]
                            self.changes = True
                        else:
                            new_pos -= 1
                            self.game_area[new_pos][j] = self.game_area[i][j]
                            self.game_area[i][j] = [None, None, 2]
                            self.changes = True

        for i in range(self.ysize):
            for j in range(self.xsize):
                if self.game_area[i][j][0] != None:
                    tile_anim = QPropertyAnimation(self.game_area[i][j][0], b"pos")
                    tile_anim.setEndValue(QPoint(self.game_area_pos[i][j][0], self.game_area_pos[i][j][1]))
                    tile_anim.setDuration(200)
                    tile_anim.setEasingCurve(QEasingCurve.OutCubic)
                    self.pos_anim.addAnimation(tile_anim)
                    if self.game_area[i][j][1] != None:
                        tile_anim = QPropertyAnimation(self.game_area[i][j][1], b"pos")
                        tile_anim.setEndValue(QPoint(self.game_area_pos[i][j][0], self.game_area_pos[i][j][1]))
                        tile_anim.setDuration(200)
                        tile_anim.setEasingCurve(QEasingCurve.OutCubic)
                        self.pos_anim.addAnimation(tile_anim)
        self.pos_anim.start()
    
    def add_tile(self):
            sec_break = False
            for i in range(self.ysize):
                if sec_break:
                    break
                for j in range(self.xsize):
                    if not self.tiles_lst[i][j][1]:
                        self.tiles_lst[i][j][1] = True
                        r, c = random.randint(0, self.ysize - 1), random.randint(0, self.xsize - 1)
                        while self.game_area[r][c][0] != None:
                            r, c = random.randint(0, self.ysize - 1), random.randint(0, self.xsize - 1)
                        if random.randint(1, 10) == 1:
                            self.game_area[r][c][2] = 4
                        else:
                            self.game_area[r][c][2] = 2
                        self.game_area[r][c][0] = self.tiles_lst[i][j][0]
                        self.game_area[r][c][0].setVisible(True)
                        self.game_area[r][c][0].setText(str(self.game_area[r][c][2]))
                        self.game_area[r][c][0].setGeometry(QRect(self.game_area_pos[r][c][0], self.game_area_pos[r][c][1], 0, 0))
                        new_tile_font = self.tile_font
                        new_tile_font.setPointSize(44 - len(str(self.game_area[r][c][2])) * 4)
                        if new_tile_font.pointSize() < 7:
                                new_tile_font.setPointSize(10)
                        self.game_area[r][c][0].setFont(new_tile_font)
                        size_anim = QPropertyAnimation(self.game_area[r][c][0], b'geometry')
                        size_anim.setStartValue(QRect(self.game_area[r][c][0].geometry().adjusted(70, 70, 0, 0)))
                        size_anim.setEndValue(QRect(self.game_area[r][c][0].geometry().adjusted(0, 0, self.tilesize, self.tilesize)))
                        size_anim.setEasingCurve(QEasingCurve.InOutQuad)
                        size_anim.setDuration(100)
                        if self.game_area[r][c][2] < 8:
                            text_color = self.text_color1
                        else:
                            text_color = self.text_color2
                        if self.game_area[r][c][2] < 4096:
                            bg_color = self.color_dict[self.game_area[r][c][2]]
                        else:
                            bg_color = self.text_color1
                        self.game_area[r][c][0].setStyleSheet(f'background-color: {bg_color}; color: {text_color}; border-radius: 10')
                        self.size_anim.addAnimation(size_anim)
                        sec_break = True
                        break
                self.size_anim.start()

    def game_window_del(self):
        for widget in self.windows[0]:
            if isinstance(widget, list):
                for i in range(self.ysize):
                    for j in range(self.xsize):
                        widget[i][j][0].deleteLater()
                        del widget[i][j][0]
            else:
                widget.deleteLater()
                del widget

    def game_window_show(self):
        for widget in self.windows[0]:
            if isinstance(widget, list):
                for i in range(self.ysize):
                    for j in range(self.xsize):
                        widget[i][j][0].show()
            else:
                widget.show()

    def game_window_init_new(self):
        self.game_window_init()
        self.game_widgets = (self.tiles_lst, self.hollows_lst, self.bg_plain, self.best_plain, self.score_plain, self.icon, self.score_value, self.best_value)
        self.windows[0] = self.game_widgets
        new_game_init_anim_group = QParallelAnimationGroup(self)
        if self.isMenuActive:
            shift = 175
        else:
            shift = 0
        for widget in self.windows[0]:
                if isinstance(widget, list):
                    for i in range(self.ysize):
                        for j in range(self.xsize):
                            new_game_init_anim = QPropertyAnimation(widget[i][j][0], b"pos")
                            new_game_init_anim.setEndValue(QPoint(widget[i][j][0].x() + shift, widget[i][j][0].y() - self.desk_h))
                            new_game_init_anim.setDuration(0)
                            new_game_init_anim_group.addAnimation(new_game_init_anim)
                else:
                    new_game_init_anim = QPropertyAnimation(widget, b"pos")
                    new_game_init_anim.setEndValue(QPoint(widget.x() + shift, widget.y() - self.desk_h))
                    new_game_init_anim.setDuration(0)
                    new_game_init_anim_group.addAnimation(new_game_init_anim)
        new_game_init_anim_group.start()
        self.window_change(0)
        self.clr_change(self.clrtheme)
        self.new_game_timer.start()

    def new_game_tiles(self):
        if self.isMenuActive:
            self.move_menu()
            self.new_game_timer.setInterval(400)
        else:
            self.new_game_timer.stop()
            for _ in range(2):
                self.add_tile()

    def game_window_init(self):
        self.score = 0
        self.isMovingAble = True
        self.game_area_pos = [[[] for j in range(self.xsize)] for i in range(self.ysize)]
        self.game_area = [[[None, None, 2] for j in range(self.xsize)] for i in range(self.ysize)]
        self.tileposy = round(self.desk_h - 162.5 * self.ysize) // 2
        for i in range(self.ysize):
            self.tileposx = round(self.desk_w - 162.5 * self.xsize) // 2
            self.tileposy += 10
            if self.ysize == 6:
                self.tileposy += 1
            if i > 0:
                self.tileposy += self.tilesize
            for j in range(self.xsize):
                self.tileposx += 10
                if self.xsize == 6:
                    self.tileposx += 1
                if j > 0:
                    self.tileposx += self.tilesize                
                self.game_area_pos[i][j].append(self.tileposx)
                self.game_area_pos[i][j].append(self.tileposy)

        self.bg_plain = QWidget(self)
        self.bg_plain.setGeometry(round(self.desk_w - 162.5 * self.xsize) // 2, round(self.desk_h - 162.5 * self.ysize) // 2, round(162.5 * self.xsize), round(162.5 * self.ysize))
        self.score_plain = QLabel("счёт", self)
        self.score_plain.setGeometry((self.desk_w - 650) // 2 + 300, round(self.desk_h - 162.5 * self.ysize) // 2 - 100, 150, 75)
        self.score_plain.setFont(self.score_plain_font)
        self.score_plain.setAlignment(Qt.AlignHCenter)
        self.score_value = QLabel(str(self.score), self)
        self.score_value.setGeometry((self.desk_w - 650) // 2 + 300, round(self.desk_h - 162.5 * self.ysize) // 2 - 67, 150, 30)
        self.score_value.setFont(self.score_plain_font)
        self.score_value.setAlignment(Qt.AlignHCenter)
        self.best_plain = QLabel("лучший", self)
        self.best_plain.setGeometry((self.desk_w - 650) // 2 + 490, round(self.desk_h - 162.5 * self.ysize) // 2 - 100, 150, 75)
        self.best_plain.setFont(self.score_plain_font)
        self.best_plain.setAlignment(Qt.AlignHCenter)
        self.best_value = QLabel(str(self.best_scores_lst[self.curmode]), self)
        self.best_value.setGeometry((self.desk_w - 650) // 2 + 490, round(self.desk_h - 162.5 * self.ysize) // 2 - 67, 150, 30)
        self.best_value.setFont(self.score_plain_font)
        self.best_value.setAlignment(Qt.AlignHCenter)
        self.icon = QLabel(self)
        self.icon.setText("2048")
        self.icon.setGeometry((self.desk_w - 650) // 2 + 8, round(self.desk_h - 162.5 * self.ysize) // 2 - 112, 255, 90)
        self.icon.setFont(self.icon_font)
        self.tiles_lst = list()
        self.hollows_lst = list()
        for i in range(self.ysize):
            self.hollows_lst.append([])
            for j in range(self.xsize):
                globals()['hollow' + str(i*(j+1) + j+1)] = QWidget(self)
                self.hollows_lst[i].append([globals()['hollow' + str(i*(j+1) + j+1)]])
        for i in range(self.ysize):
            self.tiles_lst.append([])
            for j in range(self.xsize):
                globals()['tile' + str(i*(j+1) + j+1)] = QLabel(self)
                self.tiles_lst[i].append([globals()['tile' + str(i*(j+1) + j+1)], False])
        self.pos_anim = QParallelAnimationGroup()
        self.size_anim = QParallelAnimationGroup()
        for i in range(self.ysize):
            for j in range(self.xsize):
                self.tiles_lst[i][j][0].setGeometry(self.game_area_pos[i][j][0], self.game_area_pos[i][j][1], 0, 0)
                self.tiles_lst[i][j][0].setAlignment(Qt.AlignHCenter | Qt.AlignVCenter)
                self.hollows_lst[i][j][0].setGeometry(self.game_area_pos[i][j][0], self.game_area_pos[i][j][1], self.tilesize, self.tilesize)
        self.winlose_msg_pad = QWidget(self)
        self.winlose_msg_pad.setGeometry(round(self.desk_w - 162.5 * self.xsize) // 2, round(self.desk_h - 162.5 * self.ysize) // 2, round(162.5 * self.xsize), round(162.5 * self.ysize))
        self.winlose_msg_pad.setGraphicsEffect(self.opacity)
        self.new_game_btn_panel = QLabel('начать\nновую игру', self)
        self.new_game_btn_panel.setGeometry(QRect(670, 730, 0, 0))
        self.new_game_btn_panel.setAlignment(Qt.AlignHCenter | Qt.AlignHCenter)
        self.new_game_btn_panel.setFont(self.achiev_font_mini)
        self.new_game_btn_panel.setWordWrap(True)
        self.change_mode_btn_panel = QLabel('сменить режим', self)
        self.change_mode_btn_panel.setGeometry(QRect(980, 730, 0, 0))
        self.change_mode_btn_panel.setAlignment(Qt.AlignHCenter | Qt.AlignHCenter)
        self.change_mode_btn_panel.setFont(self.achiev_font_mini)
        self.change_mode_btn_panel.setWordWrap(True)
        self.continue_game_btn_panel = QLabel('продолжить текущую игру', self)
        self.continue_game_btn_panel.setGeometry(QRect(980, 730, 0, 0))
        self.continue_game_btn_panel.setAlignment(Qt.AlignHCenter | Qt.AlignVCenter)
        self.continue_game_btn_panel.setFont(self.achiev_font_mini)
        self.continue_game_btn_panel.setWordWrap(True)
        self.new_game_btn = QPushButton(self)
        self.new_game_btn.setEnabled(False)
        self.new_game_btn.setGeometry(QRect(670, 730, 270, 80))
        self.new_game_btn.setStyleSheet('background-color: rgba(0, 0, 0, 0.0)')
        self.change_mode_btn = QPushButton(self)
        self.change_mode_btn.setEnabled(False)
        self.change_mode_btn.setGeometry(QRect(980, 730, 270, 80))
        self.change_mode_btn.setStyleSheet('background-color: rgba(0, 0, 0, 0.0)')
        self.continue_game_btn = QPushButton(self)
        self.continue_game_btn.setEnabled(False)
        self.continue_game_btn.setGeometry(QRect(980, 730, 270, 80))
        self.continue_game_btn.setStyleSheet('background-color: rgba(0, 0, 0, 0.0)')
        self.winlose_msg_text = QLabel(self)
        self.winlose_msg_text.setFont(self.icon_font)
        self.winlose_msg_text.setGeometry(QRect(635, 275, 650, 310))
        self.winlose_msg_text.setAlignment(Qt.AlignHCenter | Qt.AlignVCenter)
        self.winlose_msg_text.setWordWrap(True)
        self.game_widgets = (self.tiles_lst, self.hollows_lst, self.bg_plain, self.best_plain, self.score_plain, self.icon, self.score_value, self.best_value, 
                             self.winlose_msg_pad, self.new_game_btn, self.change_mode_btn, self.continue_game_btn,
                             self.new_game_btn_panel, self.change_mode_btn_panel, self.continue_game_btn_panel, self.winlose_msg_text)

    def new_game_btn_action(self):
        self.opacity.setOpacity(0)
        self.new_game_btn_panel.setGeometry(QRect(980, 730, 0, 0))
        self.winlose_msg_text.setText('')
        self.game_window_init_new()
        self.isGameStoped = False

    def change_mode_btn_action(self):
        self.opacity.setOpacity(0)
        self.change_mode_btn_panel.setGeometry(QRect(980, 730, 0, 0))
        self.winlose_msg_text.setText('')
        self.mode_window_init()
        self.isGameStoped = False

    def continue_game_btn_action(self):
        self.opacity.setOpacity(0)
        self.continue_game_btn_panel.setGeometry(QRect(980, 730, 0, 0))
        self.winlose_msg_text.setText('')
        self.isGameStoped = False

    def enable_moving(self):
        self.timer_times += 1
        if self.timer_times == 2:
            self.add_tile()
            self.action_timer.setInterval(100)
        elif self.timer_times == 3:
            self.action_timer.stop()
            self.show_winlose_msg(self.get_game_state())
            self.achievments_check()
            self.stats_update()
            self.isMovingAble = True
        else:
            for i in range(self.ysize):
                for j in range(self.xsize):
                    if self.game_area[i][j][2] > self.best_tiles_lst[self.curmode]:
                        self.best_tiles_lst[self.curmode] = self.game_area[i][j][2]
                    if self.game_area[i][j][0] != None:
                        if self.game_area[i][j][2] < 8:
                            text_color = self.text_color1
                        else:
                            text_color = self.text_color2
                        if self.game_area[i][j][2] < 4096:
                            bg_color = self.color_dict[self.game_area[i][j][2]]
                        else:
                            bg_color = self.text_color1
                        self.game_area[i][j][0].setStyleSheet(f'background-color: {bg_color}; color: {text_color}; border-radius: 10')
                        self.game_area[i][j][0].setText(str(self.game_area[i][j][2]))
                        new_tile_font = self.tile_font
                        new_tile_font.setPointSize(44 - len(str(self.game_area[i][j][2])) * 4)
                        if new_tile_font.pointSize() < 10:
                            new_tile_font.setPointSize(10)
                        self.game_area[i][j][0].setFont(new_tile_font)
                        if self.game_area[i][j][1] != None:
                            self.game_area[i][j][1].setGeometry(self.game_area_pos[i][j][0], self.game_area_pos[i][j][1], 0, 0)
                            for r in range(self.ysize):
                                for c in range(self.xsize):
                                    if self.tiles_lst[r][c][0] == self.game_area[i][j][1]:
                                        self.tiles_lst[r][c][1] = False
                                        self.game_area[i][j][1] = None
            self.action_timer.setInterval(50)

    def enable_menu_moving(self):
        self.menu_btn.setEnabled(True)
        self.menu_timer.stop()

    def keyPressEvent(self, e):
        self.changes = False
        if self.isMovingAble and not self.isMenuActive and not self.isGameStoped and self.curwin == 0 and self.menu_btn.isEnabled():
            self.pos_anim = QParallelAnimationGroup()
            self.size_anim = QParallelAnimationGroup()
            if e.key() == Qt.Key_D or e.key() == Qt.Key_Right or e.key() == 1042:
                self.move_tiles('right')
            elif e.key() == Qt.Key_A or e.key() == Qt.Key_Left or e.key() == 1060:
                self.move_tiles('left')
            elif e.key() == Qt.Key_W or e.key() == Qt.Key_Up or e.key() == 1062:
                self.move_tiles('up')
            elif e.key() == Qt.Key_S or e.key() == Qt.Key_Down or e.key() == 1067:
                self.move_tiles('down')
            if self.changes:
                self.score_value.setText(str(self.score))
                if self.score > self.best_scores_lst[self.curmode]:
                    self.best_scores_lst[self.curmode] = self.score
                    self.best_value.setText(str(self.best_scores_lst[self.curmode]))
                self.isMovingAble = False
                self.timer_times = 0
                self.action_timer.start()

app = QApplication(sys.argv)
main_window = MainWindow()
main_window.showMaximized()
sys.exit(app.exec_())